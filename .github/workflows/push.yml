name: Main

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - uses: linz/action-typescript@v1

    - name: Bundle
      run: yarn run bundle

    - name: Create github release
      if: startsWith(github.ref, 'refs/tags/v')
      run: npx conventional-github-releaser -p angular
      env:
        CONVENTIONAL_GITHUB_RELEASER_TOKEN: ${{secrets.GITHUB_TOKEN}}

    - name: Publish NPM
      if: startsWith(github.ref, 'refs/tags/v')
      run: yarn publish
      env:
        NODE_AUTH_TOKEN: ${{secrets.NPM_AUTH_TOKEN_LINZJS}}
